# ðŸ’° Expense Tracker

A full-stack personal expense tracking app built with MongoDB, Express, React, and Node.js (MERN stack).

## Live Demo
- **Frontend**: https://expense-tracker-nu-beryl.vercel.app
- **Backend API**: https://expense-tracker-api-vkp5.onrender.com

## GitHub Repository
https://github.com/Faehehe/expense-tracker

---

## Features
- Add expenses with amount, category, description, and date
- View all expenses in a sortable table
- Filter expenses by category
- Sort by date (newest first)
- See total amount for current filtered view
- Safe against double-submissions (idempotency)

---

## Tech Stack
| Layer | Technology |
|-------|-----------|
| Frontend | React 18, Create React App |
| Backend | Node.js, Express |
| Database | MongoDB Atlas (Mongoose) |
| Deployment | Vercel (frontend), Render (backend) |

---

## API Endpoints

### `POST /expenses`
Creates a new expense. Idempotent â€” safe to retry with same `idempotencyKey`.

**Request body:**
```json
{
  "idempotencyKey": "unique-uuid",
  "amount": "250.50",
  "category": "Food",
  "description": "Lunch",
  "date": "2024-01-15"
}
```
**Responses:** `201 Created` | `200 OK` (duplicate) | `422 Validation error`

---

### `GET /expenses`
Returns list of expenses.

**Query params:**
- `category` â€” filter by category
- `sort=date_desc` (default) or `sort=date_asc`

---

### `GET /expenses/categories`
Returns all distinct category names.

---

## Data Model

| Field | Type | Notes |
|-------|------|-------|
| `id` | ObjectId | Auto-generated |
| `amount` | Decimal128 | Exact decimal â€” avoids floating point errors |
| `category` | String | Max 100 chars |
| `description` | String | Max 500 chars |
| `date` | Date | User-supplied expense date |
| `createdAt` | Date | Auto-generated by MongoDB |
| `idempotencyKey` | String | Unique per submission attempt |

---

## Key Design Decisions

### Money stored as `Decimal128`
JavaScript `Number` (IEEE-754 double) causes rounding errors with money (e.g. `0.1 + 0.2 = 0.30000000000000004`). MongoDB's `Decimal128` stores exact decimal values. Amounts are serialised to strings in JSON to avoid precision loss.

### Idempotency on POST
Users may click submit multiple times, refresh mid-flight, or experience timeouts. Each form submission generates a UUID `idempotencyKey`. The server has a unique index on this field â€” a duplicate request returns the existing record (HTTP 200) instead of creating a new one. Race conditions are handled by catching MongoDB's duplicate key error (code 11000).

### Server-side filtering and sorting
Filtering by category and sorting by date happen on the MongoDB query, not in the browser. This keeps the frontend simple and would scale if the dataset grows large.

### Retry logic in the API client
The fetch wrapper retries up to 3 times (with 500ms delay) on network errors and 5xx responses. It never retries 4xx errors (bad input) to avoid hammering with invalid requests.

---

## Project Structure
```
expense-tracker/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ config/db.js          # MongoDB connection
â”‚   â”‚   â”œâ”€â”€ models/Expense.js     # Mongoose schema
â”‚   â”‚   â”œâ”€â”€ routes/expenses.js    # API routes
â”‚   â”‚   â””â”€â”€ server.js             # Express entry point
â”‚   â””â”€â”€ __tests__/
â”‚       â””â”€â”€ expenses.test.js      # Integration tests
â””â”€â”€ frontend/
    â””â”€â”€ src/
        â”œâ”€â”€ api/expenses.js       # Fetch client with retry
        â”œâ”€â”€ hooks/useExpenses.js  # Data fetching hook
        â”œâ”€â”€ components/
        â”‚   â”œâ”€â”€ ExpenseForm.jsx   # Add expense form
        â”‚   â””â”€â”€ ExpenseList.jsx   # Table with filter/sort
        â”œâ”€â”€ App.jsx
        â””â”€â”€ App.css
```

---

## Running Locally

### Prerequisites
- Node.js 18+
- MongoDB Atlas account (free tier)

### Backend
```bash
cd backend
cp .env.example .env   # fill in your MONGODB_URI
npm install
npm run dev            # runs on http://localhost:5000
```

### Frontend
```bash
cd frontend
echo "REACT_APP_API_URL=http://localhost:5000/expenses" > .env
npm install
npm start              # runs on http://localhost:3000
```

---

## Trade-offs & What Was Left Out

| Decision | Reason |
|----------|--------|
| No authentication | Out of scope; would add JWT in production |
| No DELETE/PATCH | Not in acceptance criteria |
| No pagination | Dataset is small for this exercise |
| Hardcoded categories in form | Speed; could fetch dynamically from `/expenses/categories` |
| Render free tier | Spins down after inactivity (~50s cold start); fine for demo |
| No global state (Redux) | Overkill for this scale; custom hook is sufficient |

---

## AI Tools Used
This project was built with assistance from Claude (Anthropic) for code generation and debugging.